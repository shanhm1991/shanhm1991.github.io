<!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="utf-8">
  
  <title>通用Admin管理系统设计 | Echo</title>
  <meta name="author" content="shanhm1991">
  
  <meta name="description" content="一般的管理系统都会涉及一些用户部门角色权限之类的管理，比如ERP/CRM/OA这些系统早都已经很多成熟的产品以及案例。这里目标是希望设计一套足够简单，能够方便自己进行复用和扩展的系统，主要内容也就是一些表结构设计，也参考了开源管理系统若依的一些经验，尤其是菜单权限设计。">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="通用Admin管理系统设计"/>
  <meta property="og:site_name" content="Echo"/>

  
    <meta property="og:image" content=""/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Echo" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-147251181-1', 'auto');
	ga('send', 'pageview');

</script>


<meta name="generator" content="Hexo 4.2.0"></head>


<body>
  <header id="header" class="inner"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="alignleft">
  <h1><a href="/">Echo</a></h1>
  <span style="color:#736f6f; height:20px;line-height:30px;">It's a long long way to go</span>
  <h2><font style="color: #736f6f;">articles:  117 &nbsp;&nbsp;&nbsp; views: <span id="busuanzi_value_site_uv"></span></font></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/about">Abount</a></li>
    
      <li><a href="/books">Books</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>

<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article id="post-20220402" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2022-04-01T16:00:00.000Z" style="margin-bottom: 10px;"><a href="/2022/04/02/20220402/" style="color: #736f6f;">2022-04-02</a></time>
      
      

  
  
    <h1 class="p-name title" itemprop="headline name">
        通用Admin管理系统设计
    </h1>
    
    
  
  
  


<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>


   <span style="line-height:35px; height:35px; ">  </span>

   <font style="color: #999;"> words: 8k  &nbsp;&nbsp; views: <span id="busuanzi_value_page_pv"></span> &nbsp;&nbsp; time: 38min</font>
   
   
  
  <div class="categories">
    <a href="/categories/开发笔记/">开发笔记</a>
  </div>


   
   

   
   <hr style="background-color: #ddd; height:1px; border:none;" /><br>
   


    </header>
      
    <div class="e-content entry" itemprop="articleBody">
      
        <p>一般的管理系统都会涉及一些用户部门角色权限之类的管理，比如ERP/CRM/OA这些系统早都已经很多成熟的产品以及案例。这里目标是希望设计一套足够简单，能够方便自己进行复用和扩展的系统，主要内容也就是一些表结构设计，也参考了开源管理系统若依的一些经验，尤其是菜单权限设计。<br><a id="more"></a></p>
<h4 id="用户部门岗位"><a href="#用户部门岗位" class="headerlink" title="用户部门岗位"></a>用户部门岗位</h4><ul>
<li>从外部系统同步数据</li>
</ul>
<p>我们的数据模型优先以自增id作为主键，但是在一些需要从外部系统接入数据的场景中，没有办法要求别人数据与我们的id保持一致。所以额外定义了一个code字段，用来记录对方数据的标识信息，这样数据接入过来之后还是统一用自增id作为表示，同时也保持了与外部数据id的对应关系。</p>
<p>另外可能也确实有一些需要展示编码的场景，比如单位编码、岗位编码等。</p>
<ul>
<li>数据关系</li>
</ul>
<p>自身层级关系：对于用户、部门、岗位，数据本身可能就存在上下级关系，并且可能是多个上级，所以分别都额外定义一个Tree关系表；</p>
<p>部门与岗位关系：多对多关系，一个部门会有多个岗位，但一个岗位也可能存在于多个部门；</p>
<p>用户与部门岗位关系：用户可能存在于一个或多个部门中；也可能兼任一个或多个岗位；或者兼任一个或多个不同部门的多个不同岗位；</p>
<ul>
<li>关系缓存</li>
</ul>
<p>为了方便Tree数据在界面查询过滤，我们会提前构建以下缓存</p>
<p>单位树缓存：<code>Tree:dept</code><br>岗位树缓存：<code>Tree:post</code><br>用户树缓存：<code>Tree:user</code><br>单位用户树缓存：<code>Tree:dept-user</code><br>单位岗位树缓存：<code>Tree:dept-post</code></p>
<p><img src="/img/20220402/20220402.2.jpg" alt=""> </p>
<p>比如上面这个单位树，我们可以直接从缓存获取。但这又有一个问题，如果数据发生了变化，应该在<strong>什么时机更新缓存</strong>？而且这可能是一个耗时操作，如果放在每次数据变化后更新，那么会增加请求耗时降低用户体验。所以我们提供了一个刷新缓存操作，交给用户自己来决定何时更新缓存，他可以在批量操作之后再刷新缓存，我们觉得以上这些并不是那种会频繁变动的业务数据，让用户自己手动刷新缓存也是能够接受的。如果因为数据量大导致刷新延时，那也是可预期的，好过那种由于刷新缓存导致其它增删改查操作出现不可预期的延时。</p>
<p>很多场景中，我们可能是获取一个子Tree，以下是使用广度优先进行遍历获取子树的示例</p>
<figure class="highlight java"><figcaption><span class="caption">Tree:dept</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String KEY_DEPT = <span class="string">"Tree:dept"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> List&lt;Tree&lt;String&gt;&gt; tree(String deptId) &#123;</span><br><span class="line">    Tree&lt;String&gt; root = redis.getValue(KEY_DEPT);</span><br><span class="line">    <span class="comment">// 如果没有传deptId，或者传的根部门id，则返回整棵树</span></span><br><span class="line">    <span class="keyword">if</span>(deptId == <span class="keyword">null</span> || deptId.equals(root.getId())) &#123;</span><br><span class="line">            <span class="keyword">return</span> List.of(root);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 空树</span></span><br><span class="line">    <span class="keyword">if</span>(CollectionUtils.isEmpty(root.getChildren())) &#123;</span><br><span class="line">        <span class="keyword">return</span> List.of(<span class="keyword">new</span> Tree&lt;&gt;());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 广度优先，如果节点id与deptId一样则返回</span></span><br><span class="line">    Deque&lt;Tree&lt;String&gt;&gt; queue = <span class="keyword">new</span> LinkedList&lt;&gt;(root.getChildren());</span><br><span class="line">    <span class="keyword">while</span> (!queue.isEmpty()) &#123;</span><br><span class="line">        root = queue.pop();</span><br><span class="line">        <span class="keyword">if</span>(Objects.equals(deptId, root.getId())) &#123;</span><br><span class="line">            <span class="keyword">return</span> List.of(root);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(CollectionUtils.isNotEmpty(root.getChildren())) &#123;</span><br><span class="line">            queue.addAll(root.getChildren());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> List.of(<span class="keyword">new</span> Tree&lt;&gt;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="角色菜单权限"><a href="#角色菜单权限" class="headerlink" title="角色菜单权限"></a>角色菜单权限</h4><p><img src="/img/20220402/20220402.3.jpg" alt=""> </p>
<p>目录：本身不跳转页面，一般只是控制菜单的收缩展开</p>
<p><img src="/img/20220402/20220402.4.jpg" alt=""> </p>
<p>菜单：具体的页面</p>
<p><img src="/img/20220402/20220402.5.jpg" alt=""> </p>
<p>按钮：页面中的操作</p>
<p><img src="/img/20220402/20220402.6.jpg" alt=""> </p>
<ul>
<li>菜单控制</li>
</ul>
<p>以上是定义的三种菜单类型，我们希望能对界面的菜单进行动态控制：</p>
<p>对于(展示)目录和菜单，可以通过角色与用户进行关联，即给角色分配菜单，再给用户分配角色，然后只返回那些与用户关联或者本身是公开的菜单；</p>
<p>对于(操作)按钮，可以通过权限符来控制。我们在菜单上添加一个权限符标识，这里的菜单可以是一个具体的菜单或按钮，也可以是一个抽象的操作权限定义。相当于在按钮与角色之间添加了一层权限，这样就可以给一个权限分配多个菜单（多个菜单共用一个权限符），然后给一个角色分配多个权限，再给用户分配多个角色。</p>
<p>在实际操作中，我们还是统一以菜单来进行分配操作，因为菜单展示更直观一些，而且大多情况下，操作权限与菜单按钮是一一对应的（如果控制粒度够细的话）。如果对角色分配到的菜单进行权限符聚合去重，就可以得到角色的权限了（这样有个缺点，如果A和B共用权限标识，那么给角色分配了A菜单也就分配了B菜单，但用户可能不想这样，需要通过细化权限粒度解决）。</p>
<p>以下给普通角色分配菜单权限，这里只读控制权限就控制了所有界面中的只读按钮，当然也可以细化给每个只读按钮定义一个权限</p>
<p><img src="/img/20220402/20220402.7.jpg" alt=""> </p>
<p>在登录返回的Token信息中会包含用户的权限集合，那么可以根据用户的权限，以及按钮所绑定的权限符，来决定是显示还是移除按钮</p>
<figure class="highlight js"><figcaption><span class="caption">hasPermi.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'@/store'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  inserted(el, binding, vnode) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; value &#125; = binding</span><br><span class="line">    <span class="keyword">const</span> permissions = store.getters &amp;&amp; store.getters.permissions</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (value &amp;&amp; value <span class="keyword">instanceof</span> <span class="built_in">Array</span> &amp;&amp; value.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> permissionFlag = value</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> hasPermissions = permissions.some(<span class="function"><span class="params">permission</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"*:*:*"</span> === permission || permissionFlag.includes(permission)</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!hasPermissions) &#123;</span><br><span class="line">        el.parentNode &amp;&amp; el.parentNode.removeChild(el)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以简单通过标签在目标按钮上绑定权限符</p>
<figure class="highlight js"><figcaption><span class="fileDir">user/</span><span class="caption">index.vue</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-row :gutter=<span class="string">"10"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"mb8"</span>&gt;</span><br><span class="line">    &lt;el-col :span=<span class="string">"1.5"</span>&gt;</span><br><span class="line">        &lt;el-button type=<span class="string">"primary"</span> plain icon=<span class="string">"el-icon-plus"</span> size=<span class="string">"mini"</span></span><br><span class="line">                @click=<span class="string">"handleAdd"</span> v-hasPermi=<span class="string">"['sys:user:new']"</span>&gt;&#123;&#123;$t(<span class="string">'route.system.user.new'</span>)&#125;&#125;&lt;<span class="regexp">/el-button&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>el-col&gt;</span><br><span class="line">    &lt;el-col :span=<span class="string">"1.5"</span>&gt;</span><br><span class="line">        &lt;el-button type=<span class="string">"success"</span> plain icon=<span class="string">"el-icon-edit"</span> size=<span class="string">"mini"</span> :disabled=<span class="string">"single"</span></span><br><span class="line">                @click=<span class="string">"handleUpdate"</span> v-hasPermi=<span class="string">"['sys:user:edit']"</span>&gt;&#123;&#123;$t(<span class="string">'route.system.user.edit'</span>)&#125;&#125;&lt;<span class="regexp">/el-button&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>el-col&gt;</span><br><span class="line">    &lt;el-col :span=<span class="string">"1.5"</span>&gt;</span><br><span class="line">        &lt;el-button type=<span class="string">"danger"</span> plain icon=<span class="string">"el-icon-delete"</span> size=<span class="string">"mini"</span> :disabled=<span class="string">"multiple"</span></span><br><span class="line">                @click=<span class="string">"handleDelete"</span> v-hasPermi=<span class="string">"['sys:user:delete']"</span>&gt;&#123;&#123;$t(<span class="string">'route.system.user.delete'</span>)&#125;&#125;&lt;<span class="regexp">/el-button&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>el-col&gt;</span><br><span class="line">&lt;<span class="regexp">/el-row&gt;</span></span><br></pre></td></tr></table></figure>
<p>类似的，也可以通过角色来进行按钮元素控制</p>
<figure class="highlight js"><figcaption><span class="caption">hasRole.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'@/store'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  inserted(el, binding, vnode) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; value &#125; = binding</span><br><span class="line">    <span class="keyword">const</span> roles = store.getters &amp;&amp; store.getters.roles</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (value &amp;&amp; value <span class="keyword">instanceof</span> <span class="built_in">Array</span> &amp;&amp; value.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> roleFlag = value</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> hasRole = roles.some(<span class="function"><span class="params">role</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"sysAdmin"</span> === role || roleFlag.includes(role)</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!hasRole) &#123;</span><br><span class="line">        el.parentNode &amp;&amp; el.parentNode.removeChild(el)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>接口权限</li>
</ul>
<p>对应的在后端服务中，也可以根据用户权限进行判断</p>
<figure class="highlight java"><figcaption><span class="caption">PermissionService.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConditionalOnClass</span>(WebSecurityConfigurerAdapter<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line">@Service("permit")</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PermissionService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isAdmin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; roles = Access.userRoles();</span><br><span class="line">        <span class="keyword">if</span>(CollectionUtils.isEmpty(roles)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> roles.contains(<span class="string">"sysAdmin"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasPermit</span><span class="params">(String permission)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(isAdmin()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        List&lt;String&gt; perms = Access.userPermissions();</span><br><span class="line">        <span class="keyword">if</span>(CollectionUtils.isEmpty(perms)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> perms.contains(permission);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasRole</span><span class="params">(String role)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(isAdmin()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;String&gt; roles = Access.userRoles();</span><br><span class="line">        <span class="keyword">if</span>(CollectionUtils.isEmpty(roles)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> roles.contains(role);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后通过<code>@PreAuthorize</code>给接口绑定所需要的权限</p>
<figure class="highlight java"><figcaption><span class="caption">SysUserController.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PreAuthorize</span>(<span class="string">"@permit.hasPermit('sys:user:new')"</span>)</span><br><span class="line"><span class="meta">@PostMapping</span>(<span class="string">"/add"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Response&lt;Void&gt; <span class="title">add</span><span class="params">(@Validated @RequestBody SysUser sysUser)</span> </span>&#123;</span><br><span class="line">    sysUserService.add(sysUser);</span><br><span class="line">    <span class="keyword">return</span> Response.success();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@PreAuthorize</span>(<span class="string">"@permit.hasPermit('sys:user:edit')"</span>)</span><br><span class="line"><span class="meta">@PostMapping</span>(<span class="string">"/edit"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Response&lt;SysUser&gt; <span class="title">edit</span><span class="params">(@Validated @RequestBody SysUser sysUser)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Response.success(sysUserService.edit(sysUser));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@PreAuthorize</span>(<span class="string">"@permit.hasPermit('sys:user:delete')"</span>)</span><br><span class="line"><span class="meta">@GetMapping</span>(value = &#123;<span class="string">"/delete"</span>&#125;)</span><br><span class="line"> <span class="keyword">public</span> Response&lt;List&lt;SysUser&gt;&gt; delete(<span class="meta">@NotNull</span>(message = <span class="string">"user.notnull.id"</span>) Long[] userId) &#123;</span><br><span class="line">    <span class="keyword">return</span> Response.success(sysUserService.delete(userId));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="字典信息"><a href="#字典信息" class="headerlink" title="字典信息"></a>字典信息</h4><p><img src="/img/20220402/20220402.8.jpg" alt=""> </p>
<ul>
<li>分组分类</li>
</ul>
<p>为了方便字典管理，一般都会字典信息进行分组分类，但是又如何来定义字典的分组和分类？我们不希望要维护额外的信息，所以想法是直接用字典来定义字典的分组和分类，可以使用<code>parent_code</code>来给字典码添加层级关系，然后定义一个根字典<code>dict_root</code>，接着可以在根字典下面添加分组字典，在分组字典下面添加类型字典，最后在类型字典下面再添加具体的字典，像下面这样</p>
<p><img src="/img/20220402/20220402.9.jpg" alt=""> </p>
<p>其实有了层级关系，就可以构造任意多层字典关系，不过大多场景下有了分组分类两层关系也就足够了，这样也方便直接查询出所有的分组分类</p>
<figure class="highlight sql"><figcaption><span class="caption">options</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> t.group_code,</span><br><span class="line">        <span class="keyword">case</span> t.group_code <span class="keyword">when</span> <span class="string">'dict_root'</span> <span class="keyword">then</span> <span class="string">'根字典'</span> <span class="keyword">else</span> d1.dict_label <span class="keyword">end</span> group_name,</span><br><span class="line">        <span class="keyword">case</span> t.group_code <span class="keyword">when</span> <span class="string">'dict_root'</span> <span class="keyword">then</span> <span class="string">'dict_root'</span> <span class="keyword">else</span> d1.dict_label <span class="keyword">end</span> group_en,</span><br><span class="line">        t.type_code, d2.dict_label type_name, d2.dict_en type_en</span><br><span class="line"><span class="keyword">from</span>(<span class="keyword">with</span> <span class="keyword">groups</span> <span class="keyword">as</span> (<span class="keyword">select</span> parent_code, dict_code <span class="keyword">from</span> sys_dict <span class="keyword">where</span> parent_code = <span class="string">'dict_group'</span>)</span><br><span class="line">        <span class="keyword">select</span> d1.parent_code <span class="keyword">as</span> group_code, d1.dict_code <span class="keyword">as</span> type_code <span class="keyword">from</span> sys_dict d1 <span class="keyword">where</span> d1.parent_code = <span class="string">'dict_root'</span> <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">        <span class="keyword">select</span> groups.parent_code <span class="keyword">as</span> group_code, groups.dict_code <span class="keyword">as</span> type_code f   rom <span class="keyword">groups</span> <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">        <span class="keyword">select</span> d.parent_code <span class="keyword">as</span> group_code, d.dict_code <span class="keyword">as</span> type_code <span class="keyword">from</span> sys_dict d, <span class="keyword">groups</span> <span class="keyword">where</span> d.parent_code = groups.dict_code) t</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> sys_dict d1 <span class="keyword">on</span> t.group_code = d1.dict_code</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> sys_dict d2 <span class="keyword">on</span> t.type_code = d2.dict_code</span><br></pre></td></tr></table></figure>
<ul>
<li>字典缓存</li>
</ul>
<p>可以抽象出一个接口，方便进行统一的缓存操作</p>
<figure class="highlight java"><figcaption><span class="caption">Dict.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Dict</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">getGroupCode</span><span class="params">()</span></span>;  <span class="comment">// 字典分组</span></span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">getTypeCode</span><span class="params">()</span></span>;   <span class="comment">// 字典类型</span></span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">getDictCode</span><span class="params">()</span></span>;   <span class="comment">// 字典码</span></span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">getDictLabel</span><span class="params">()</span></span>;  <span class="comment">// 字典名称</span></span><br><span class="line"></span><br><span class="line">    <span class="function">Object <span class="title">getDictValue</span><span class="params">()</span></span>;  <span class="comment">// 字典值</span></span><br><span class="line"></span><br><span class="line">    <span class="function">Integer <span class="title">getDictOrder</span><span class="params">()</span></span>; <span class="comment">// 字典排序</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过关联查询，可以列出所有字典及对应的分组分类</p>
<figure class="highlight sql"><figcaption><span class="caption">list</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line"><span class="keyword">case</span> d.parent_code <span class="keyword">when</span> <span class="string">'dict_root'</span> <span class="keyword">then</span> <span class="string">'根字典'</span> <span class="keyword">when</span> <span class="string">'dict_group'</span> <span class="keyword">then</span> <span class="string">'根字典'</span> <span class="keyword">else</span> g.dict_label <span class="keyword">end</span> groupName,</span><br><span class="line"><span class="keyword">case</span> d.parent_code <span class="keyword">when</span> <span class="string">'dict_root'</span> <span class="keyword">then</span> <span class="string">'dict_root'</span>  <span class="keyword">when</span> <span class="string">'dict_group'</span> <span class="keyword">then</span> <span class="string">'dict_root'</span> <span class="keyword">else</span> g.dict_en <span class="keyword">end</span> groupEn,</span><br><span class="line"><span class="keyword">case</span> d.parent_code <span class="keyword">when</span> <span class="string">'dict_root'</span> <span class="keyword">then</span> <span class="string">'dict_root'</span>  <span class="keyword">when</span> <span class="string">'dict_group'</span> <span class="keyword">then</span> <span class="string">'dict_root'</span> <span class="keyword">else</span> g.dict_code <span class="keyword">end</span> groupCode,</span><br><span class="line"><span class="keyword">case</span> d.parent_code <span class="keyword">when</span> <span class="string">'dict_root'</span> <span class="keyword">then</span> <span class="string">'根字典'</span> <span class="keyword">else</span> t.dict_label <span class="keyword">end</span> typeName,</span><br><span class="line"><span class="keyword">case</span> d.parent_code <span class="keyword">when</span> <span class="string">'dict_root'</span> <span class="keyword">then</span> <span class="string">'dict_root'</span>  <span class="keyword">else</span> t.dict_en <span class="keyword">end</span> typeEn,</span><br><span class="line"><span class="keyword">case</span> d.parent_code <span class="keyword">when</span> <span class="string">'dict_root'</span> <span class="keyword">then</span> <span class="string">'dict_root'</span>  <span class="keyword">else</span> t.dict_code <span class="keyword">end</span> typeCode,</span><br><span class="line">d.id, d.dict_code dictCode, d.dict_label dictLabel, d.dict_en dictEn, d.dict_value dictValue,</span><br><span class="line"><span class="keyword">from</span> sys_dict d</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> sys_dict t <span class="keyword">on</span> d.parent_code = t.dict_code</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> sys_dict g <span class="keyword">on</span> t.parent_code = g.dict_code</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> d.dict_order, d.parent_code</span><br></pre></td></tr></table></figure>
<p><img src="/img/20220402/20220402.10.jpg" alt=""> </p>
<p>然后我们构建如下三个缓存Key</p>
<figure class="highlight java"><figcaption><span class="caption">DictHelper.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String KEY_DICT = <span class="string">"sys-dict:dict:"</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String KEY_TYPE = <span class="string">"sys-dict:type:"</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String KEY_GROUP = <span class="string">"sys-dict:group:"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(Dict dict)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="string">"dict_root"</span>.equals(dict.getTypeCode()))&#123;</span><br><span class="line">        redis.putMapValue(KEY_GROUP + dict.getGroupCode(), dict.getDictCode(), dict);</span><br><span class="line">        <span class="keyword">if</span>(!<span class="string">"dict_root"</span>.equals(dict.getGroupCode()))&#123;</span><br><span class="line">            redis.putMapValue(KEY_TYPE + dict.getTypeCode(), dict.getDictCode(), dict);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    redis.putValue(KEY_DICT + dict.getDictCode(), dict);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>于是：<br>通过<code>sys-dict:dict:{dictCode}</code>可以获取某个字典；<br>通过<code>sys-dict:type:{typeCode}</code>可以获取某个类型下的所有字典；<br>通过<code>sys-dict:group:{groupCode}</code>可以获取某个分组下面的所有字典（除了类型字典）；<br>通过<code>sys-dict:type:{groupCode}</code>可以获取某个分组下面的所有类型字典；<br>通过<code>sys-dict:type:dict_root</code>可以获取所有的分组字典；<br>通过<code>sys-dict:type:dict_group</code>可以获取所有的类型字典；</p>
<figure class="highlight java"><figcaption><span class="caption">DictHelper.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;T extends Dict&gt; <span class="function">List&lt;T&gt; <span class="title">getGroup</span><span class="params">(String groupCode)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(StringUtils.isBlank(groupCode))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">    Map&lt;String, T&gt; map = redis.getMap(KEY_GROUP + groupCode);</span><br><span class="line">    <span class="keyword">if</span>(map == <span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">    List&lt;T&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;(map.values());</span><br><span class="line">    list.sort(Comparator.comparingInt(Dict::getDictOrder));</span><br><span class="line">    <span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> &lt;T extends Dict&gt; <span class="function">List&lt;T&gt; <span class="title">getType</span><span class="params">(String typeCode)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(StringUtils.isBlank(typeCode))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">    Map&lt;String, T&gt; map = redis.getMap(KEY_TYPE + typeCode);</span><br><span class="line">    <span class="keyword">if</span>(map == <span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">    List&lt;T&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;(map.values());</span><br><span class="line">    list.sort(Comparator.comparingInt(Dict::getDictOrder));</span><br><span class="line">    <span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> &lt;T extends Dict&gt; <span class="function">T <span class="title">getDict</span><span class="params">(String dictCode)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(StringUtils.isBlank(dictCode))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> redis.getValue(KEY_DICT + dictCode);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getDictLabel</span><span class="params">(String dictCode)</span> </span>&#123;</span><br><span class="line">    Dict dict = getDict(dictCode);</span><br><span class="line">    <span class="keyword">if</span>(dict == <span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dict.getDictLabel();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">getDictValue</span><span class="params">(String dictCode)</span> </span>&#123;</span><br><span class="line">    Dict dict = getDict(dictCode);</span><br><span class="line">    <span class="keyword">if</span>(dict == <span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (T)dict.getDictValue();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>方便字典获取的代价是提高了维护的成本，比如对应的删除操作</p>
<figure class="highlight java"><figcaption><span class="caption">DictHelper.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeDict</span><span class="params">(String dictCode)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(StringUtils.isBlank(dictCode))&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Dict dict =redis.getValue(KEY_DICT + dictCode);</span><br><span class="line">    <span class="keyword">if</span>(dict == <span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    redis.delete(KEY_DICT + dictCode);</span><br><span class="line">    redis.deleteMapValue(KEY_TYPE + dict.getTypeCode(), dictCode);</span><br><span class="line">    redis.deleteMapValue(KEY_GROUP + dict.getGroupCode(), dictCode);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeType</span><span class="params">(String typeCode)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(StringUtils.isBlank(typeCode))&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Map&lt;String, Dict&gt; dictMap = redis.getMap(KEY_TYPE + typeCode);</span><br><span class="line">    <span class="keyword">if</span>(dictMap != <span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span>(Dict dict : dictMap.values())&#123;</span><br><span class="line">            <span class="comment">// 删除sys-dict:dict:&#123;dictCode&#125;</span></span><br><span class="line">            redis.delete(KEY_DICT + dict.getDictCode());</span><br><span class="line">            <span class="comment">// 从sys-dict:dict:&#123;groupCode&#125;中删除</span></span><br><span class="line">            redis.deleteMapValue(KEY_GROUP + dict.getGroupCode(), dict.getDictCode());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 删除sys-dict:type:&#123;typeCode&#125;</span></span><br><span class="line">    redis.delete(KEY_TYPE + typeCode);</span><br><span class="line">    <span class="comment">// 从sys-dict:group:dict_group中删除类型</span></span><br><span class="line">    redis.deleteMapValue(KEY_GROUP + <span class="string">"dict_group"</span>, typeCode);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeGroup</span><span class="params">(String groupCode)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(StringUtils.isBlank(groupCode))&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Map&lt;String, Dict&gt; TypeMap = redis.getMap(KEY_TYPE + groupCode);</span><br><span class="line">    <span class="keyword">if</span>(TypeMap != <span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="comment">// 删除sys-dict:type:&#123;groupCode&#125;</span></span><br><span class="line">        redis.delete(KEY_TYPE + groupCode);</span><br><span class="line">        <span class="comment">// 从sys-dict:group:dict_group中删除类型</span></span><br><span class="line">        <span class="keyword">for</span>(Dict type : TypeMap.values())&#123;</span><br><span class="line">            redis.deleteMapValue(KEY_GROUP + <span class="string">"dict_group"</span>, type.getDictCode());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Map&lt;String, Dict&gt; dictMap = redis.getMap(KEY_GROUP + groupCode);</span><br><span class="line">    <span class="keyword">if</span>(dictMap != <span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span>(Dict dict : dictMap.values())&#123;</span><br><span class="line">            <span class="comment">// 删除sys-dict:dict:&#123;dictCode&#125;</span></span><br><span class="line">            redis.delete(KEY_DICT + dict.getDictCode());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 删除sys-dict:group:&#123;groupCode&#125;</span></span><br><span class="line">    redis.delete(KEY_GROUP + groupCode);</span><br><span class="line">    <span class="comment">// 从sys-dict:group:dict_root中删除分组</span></span><br><span class="line">    redis.deleteMapValue(KEY_GROUP + <span class="string">"dict_root"</span>, groupCode);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>字典值转换</li>
</ul>
<p>通常我们定义的字典值都是String类型，但在实际使用时可能实际需要的是一个整形数值，那么就需要类型转换，如果忘记了转换可能会出现一些意料之外的问题。所以我们定义个字典值转换器接口，在放入缓存时就进行转换。</p>
<figure class="highlight java"><figcaption><span class="caption">DictValueParser.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DictValueParser</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">Object <span class="title">parse</span><span class="params">(String value, String param)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>比如下面时提供的一个默认转换器，可以对基本类型做一些转换</p>
<figure class="highlight java"><figcaption><span class="caption">DefaultValueParser.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultValueParser</span> <span class="keyword">implements</span> <span class="title">DictValueParser</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">parse</span><span class="params">(String value, String param)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(value == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">switch</span> (param) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"short"</span> -&gt; Short.parseShort(value);</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"int"</span> -&gt; Integer.parseInt(value);</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"long"</span> -&gt; Long.parseLong(value);</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"float"</span> -&gt; Float.parseFloat(value);</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"double"</span> -&gt; Double.parseDouble(value);</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"boolean"</span> -&gt; Boolean.parseBoolean(value);</span><br><span class="line">            <span class="keyword">default</span> -&gt; value;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在构造字典缓存之前，会检查字典是否设置了值转换器，如果设置了就转换一下值类型</p>
<figure class="highlight java"><figcaption><span class="caption">SysDictCaches.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">refresh</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    AccessLogger.info(<span class="string">"refresh cache of dict ..."</span>);</span><br><span class="line">    dict.clear();</span><br><span class="line">    List&lt;SysDict&gt; list = sysDictMapper.list(<span class="keyword">null</span>,<span class="keyword">null</span>);</span><br><span class="line">    <span class="keyword">for</span>(SysDict sysDict : list) &#123;</span><br><span class="line">        String parserClazz = sysDict.getValueParser();</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isBlank(parserClazz))&#123;</span><br><span class="line">            dict.put(sysDict);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            DictValueParser parser = parserMap.get(parserClazz);</span><br><span class="line">            <span class="keyword">if</span>(parser == <span class="keyword">null</span>)&#123;</span><br><span class="line">                parser = (DictValueParser)Class.forName(parserClazz).getDeclaredConstructor().newInstance();</span><br><span class="line">                parserMap.put(parserClazz, parser);</span><br><span class="line">            &#125;</span><br><span class="line">            sysDict.setDictValue(parser.parse(String.valueOf(sysDict.getDictValue()), sysDict.getValueParam()));</span><br><span class="line">            dict.put(sysDict);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="附件信息"><a href="#附件信息" class="headerlink" title="附件信息"></a>附件信息</h4><p>有很多这样的场景，先上传附件得到url，然后再提交表单，将附件url填到业务数据中。但是如果附件上传之后，提交表单被取消或失败了，那么已经上传的附件就会变成脏数据。</p>
<figure class="highlight java"><figcaption><span class="caption">SysAttachServiceImpl.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span>(rollbackFor = Exception<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">Override</span></span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">SysAttach</span> <span class="title">upload</span>(<span class="title">MultipartFile</span> <span class="title">file</span>, <span class="title">SysAttach</span> <span class="title">sysAttach</span>, <span class="title">boolean</span> <span class="title">isPublic</span>) <span class="title">throws</span> <span class="title">Exception</span> </span>&#123;</span><br><span class="line">    String fileName = file.getOriginalFilename();</span><br><span class="line">    sysAttach.setAttachName(fileName);</span><br><span class="line">    sysAttach.setAttachSize(file.getSize());</span><br><span class="line">    sysAttach.setCreateTime(<span class="keyword">new</span> Date());</span><br><span class="line">    sysAttach.setIsPublic(isPublic ? <span class="number">1</span> : <span class="number">0</span>);</span><br><span class="line">    String filePath = sysAttach.getAttachType()</span><br><span class="line">            + <span class="string">"/"</span> + DateUtils.format(<span class="string">"yyyy-MM"</span>) + <span class="string">"/"</span> + IdUtil.randomUUID() + <span class="string">"."</span> + fileName;</span><br><span class="line">    sysAttach.setAttachPath(filePath);</span><br><span class="line">    sysAttachMapper.insert(sysAttach);</span><br><span class="line"></span><br><span class="line">    fileService.minioUpload(file, sysAttach.getAttachGroup(), filePath, isPublic);</span><br><span class="line">    <span class="keyword">return</span> sysAttach;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对于这个问题，可以在上传之前先将附件信息入库（上传失败了可以回滚），然后在长传成功之后将附件信息返回给客户端，客户端可以拿到附件上传的url和附件信息的id。这样要求业务在提交数据时根据附件id更新附件记录的宿主信息，所以对于那些没有宿主信息，并且创建超过了一定时间的附件记录，有理由认为它就是脏数据，可以检查出来进行删除，并清理对应的上传文件。</p>
<p>有了附件记录表，就方便做一些结构化的统计处理，比如根据附件的宿主进行分组分类，也方便对上传的文件设置过期时间，可以简单通过定时任务检查并清理过期了的附件。</p>
<h4 id="操作日志"><a href="#操作日志" class="headerlink" title="操作日志"></a>操作日志</h4><figure class="highlight java"><figcaption><span class="caption">SysUserController.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Log</span>(type = <span class="string">"admin_user"</span>, action = <span class="string">"add"</span>, desc = <span class="string">"新增用户：#&#123;sysUser.userName&#125;"</span>, content = Content.REQ)</span><br><span class="line"><span class="meta">@PostMapping</span>(<span class="string">"/add"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Response&lt;Void&gt; <span class="title">add</span><span class="params">(@Validated @RequestBody SysUser sysUser)</span> </span>&#123;</span><br><span class="line">    sysUserService.add(sysUser);</span><br><span class="line">    <span class="keyword">return</span> Response.success();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Log</span>(type = <span class="string">"admin_user"</span>, action = <span class="string">"edit"</span>, desc = <span class="string">"修改用户：#&#123;resp.userName&#125;"</span>, content = Content.ALL)</span><br><span class="line"><span class="meta">@PostMapping</span>(<span class="string">"/edit"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Response&lt;SysUser&gt; <span class="title">edit</span><span class="params">(@Validated @RequestBody SysUser sysUser)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Response.success(sysUserService.edit(sysUser));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Log</span>(type = <span class="string">"admin_user"</span>, action = <span class="string">"delete"</span>, desc = <span class="string">"删除用户"</span>, content = Content.RESP)</span><br><span class="line"><span class="meta">@GetMapping</span>(value = &#123;<span class="string">"/delete"</span>&#125;)</span><br><span class="line"><span class="keyword">public</span> Response&lt;List&lt;SysUser&gt;&gt; delete(<span class="meta">@NotNull</span>(message = <span class="string">"user.notnull.id"</span>) Long[] userId) &#123;</span><br><span class="line">    <span class="keyword">return</span> Response.success(sysUserService.delete(userId));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上是我们记录操作日志的方式，这里的type和action需要硬编码，对应的值在字典中定义，desc描述可以使用简单的SPEL表达式，content内容固定，可以选择请求参数或者响应结果。这里不去讨论如何记录日志，我们希望日志展示的可读性能友好一点，并且不同的业务日志可以区分展示。办法是通过表单来控制，将<code>type</code>字典的值就设置成表单key，然后在表单中再根据<code>action</code>动作的不同进行区分渲染。</p>
<p>日志记录中会关联字典信息，也就是表单key，然后我们就可以在点击进入详情时选择对应的表单了</p>
<figure class="highlight js"><figcaption><span class="fileDir">log/</span><span class="caption">index.vue</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;log-detail v-<span class="keyword">if</span>=<span class="string">"viewKey === 'log-detail'"</span> ref=<span class="string">"log-detail"</span> @ok=<span class="string">"handleQuery"</span> /&gt;</span><br><span class="line">&lt;log-user v-<span class="keyword">if</span>=<span class="string">"viewKey === 'log-user'"</span> ref=<span class="string">"log-user"</span> @ok=<span class="string">"handleQuery"</span> /&gt;</span><br><span class="line">&lt;log-dept v-<span class="keyword">if</span>=<span class="string">"viewKey === 'log-dept'"</span> ref=<span class="string">"log-dept"</span> @ok=<span class="string">"handleQuery"</span> /&gt;</span><br><span class="line">&lt;log-role v-<span class="keyword">if</span>=<span class="string">"viewKey === 'log-role'"</span> ref=<span class="string">"log-role"</span> @ok=<span class="string">"handleQuery"</span> /&gt;</span><br><span class="line">&lt;log-post v-<span class="keyword">if</span>=<span class="string">"viewKey === 'log-post'"</span> ref=<span class="string">"log-post"</span> @ok=<span class="string">"handleQuery"</span> /&gt;</span><br><span class="line"></span><br><span class="line">handleView(row) &#123;</span><br><span class="line">    <span class="keyword">this</span>.viewKey = row.viewKey</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.$refs[row.viewKey].show(row.id);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/img/20220402/20220402.11.jpg" alt=""> </p>
<p>将日志对应到表单之后，我们就可以在获取日志内容展示的时候做一些处理了。这样在日志记录时就不需要关心字段含义，或者内容组织之类的事情了，可以放到放到查询展示时处理，对应的表单必然知道字段含义，以及内容要如何展示，甚至它可以自己补充内容。</p>
<p><img src="/img/20220402/20220402.12.jpg" alt=""> </p>
<h4 id="系统公告"><a href="#系统公告" class="headerlink" title="系统公告"></a>系统公告</h4><p>消息公告是很常见的功能，系统用户可以创建一个消息（也可以系统后台生成消息），然后发送给目标用户或群体，并通过websocket推送给当前在线的目标用户（这里用的socketIo有个问题，由于java服务端的依赖包已经太久没有更新，前端的socket.io-client只能选择对应的老版本）。</p>
<p><img src="/img/20220402/20220402.13.jpg" alt=""> </p>
<p>我们希望对公告做一个已读信息展示，包括接收者的反馈。办法是添加一个read表，在公告发布时将目标全部翻译成具体的用户，并作为未读记录插入到read表，然后更新公告信息的阅读总数，后面就交给目标用户操作时更新就行了。</p>
<p><img src="/img/20220402/20220402.14.jpg" alt=""> </p>
<h4 id="系统告警"><a href="#系统告警" class="headerlink" title="系统告警"></a>系统告警</h4><h4 id="数据权限"><a href="#数据权限" class="headerlink" title="数据权限"></a>数据权限</h4><h4 id="国际化处理"><a href="#国际化处理" class="headerlink" title="国际化处理"></a>国际化处理</h4><p>对于界面的静态信息，以及服务端的提示信息，可以直接编辑对应的国际化资源，界面可以在Http消息头中设置参数<code>Accept-Language</code>来告诉服务端当前使用什么语言；</p>
<p>对于动态菜单的国际化，可以在前端编辑好国际化资源，然后在定义菜单名称时使用国际化的key，比如上面角色菜单权限中所示；</p>
<p>对于字典的国际化，只能添加两种语言名称了，界面在展示时根据语言环境进行选择（但是这样只能两种语言，不过一般也够了）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;template slot-scope=<span class="string">"&#123;row: &#123;rank&#125;&#125;"</span>&gt;</span><br><span class="line">    &lt;template v-<span class="keyword">for</span>=<span class="string">"item in dict.type.post_level"</span>&gt;</span><br><span class="line">        &lt;span v-<span class="keyword">if</span>=<span class="string">"rank === item.value &amp;&amp; $i18n.locale==='zh'"</span>&gt;&#123;&#123; item.value &#125;&#125;/&#123;&#123; item.label &#125;&#125;&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">        &lt;span v-if="rank === item.value &amp;&amp; $i18n.locale==='en'"&gt;&#123;&#123; item.value &#125;&#125;/</span>&#123;&#123; item.labelEn &#125;&#125;&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>template&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br></pre></td></tr></table></figure>
<p>对于服务一些异常的国际化，也可以将message定义成国际化的key，然后交给异常统一处理器获取出来进行转换</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NotBlank</span>(message = <span class="string">"user.notnull.name"</span>)</span><br><span class="line"><span class="keyword">private</span> String userName;</span><br><span class="line"></span><br><span class="line"><span class="meta">@NotBlank</span>(message = <span class="string">"user.notnull.account"</span>)</span><br><span class="line"><span class="keyword">private</span> String userAccount;</span><br></pre></td></tr></table></figure>
<h3 id="附录：表结构"><a href="#附录：表结构" class="headerlink" title="附录：表结构"></a>附录：表结构</h3><p>具体的表结构关系简单如下：</p>
<p><img src="/img/20220402/20220402.1.jpg" alt=""> </p>
<ul>
<li>部门</li>
</ul>
<figure class="highlight sql"><figcaption><span class="caption">1.部门信息</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> sys_dept(</span><br><span class="line">    dept_id       bigserial primary <span class="keyword">key</span>,</span><br><span class="line">    dept_code     <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">64</span>),</span><br><span class="line">    dept_name     <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">128</span>),</span><br><span class="line">    dept_short    <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">64</span>),</span><br><span class="line">    dept_addr     <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">512</span>),</span><br><span class="line">    dept_phone    <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">64</span>),</span><br><span class="line">    remark        <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">200</span>),</span><br><span class="line">    read_only     int2 <span class="keyword">default</span> <span class="number">0</span>,</span><br><span class="line">    create_user   <span class="built_in">int8</span>,</span><br><span class="line">    create_dept   <span class="built_in">int8</span>,</span><br><span class="line">    create_time   <span class="built_in">timestamp</span>,</span><br><span class="line">    update_user   <span class="built_in">int8</span>,</span><br><span class="line">    update_dept   <span class="built_in">int8</span>,</span><br><span class="line">    update_time  <span class="built_in">timestamp</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">table</span> sys_dept <span class="keyword">is</span> <span class="string">'部门信息'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_dept.dept_id <span class="keyword">is</span> <span class="string">'部门id'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_dept.dept_code <span class="keyword">is</span> <span class="string">'部门编码'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_dept.dept_name <span class="keyword">is</span> <span class="string">'部门名称'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_dept.dept_short <span class="keyword">is</span> <span class="string">'部门简称'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_dept.dept_addr <span class="keyword">is</span> <span class="string">'部门地址'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_dept.dept_phone <span class="keyword">is</span> <span class="string">'部门电话'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_dept.remark <span class="keyword">is</span> <span class="string">'备注'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_dept.read_only <span class="keyword">is</span> <span class="string">'是否只读 1是 0否'</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><figcaption><span class="caption">2.部门关系</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> sys_dept_tree(</span><br><span class="line">    dept_id   <span class="built_in">int8</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    parent_id <span class="built_in">int8</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    tree_type int2 <span class="keyword">default</span> <span class="number">1</span>,</span><br><span class="line">    <span class="keyword">constraint</span> sys_dept_tree_pkey primary <span class="keyword">key</span> (dept_id, parent_id, tree_type)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">table</span> sys_dept_tree <span class="keyword">is</span> <span class="string">'部门关系'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_dept_tree.dept_id <span class="keyword">is</span> <span class="string">'部门id'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_dept_tree.parent_id <span class="keyword">is</span> <span class="string">'上级部门id'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_dept_tree.tree_type <span class="keyword">is</span> <span class="string">'关系类型'</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>岗位</li>
</ul>
<figure class="highlight sql"><figcaption><span class="caption">3.岗位信息</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> sys_post (</span><br><span class="line">    post_id bigserial primary <span class="keyword">key</span>,</span><br><span class="line">    post_code <span class="built_in">varchar</span>(<span class="number">64</span>),</span><br><span class="line">    post_name <span class="built_in">varchar</span>(<span class="number">64</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    post_level  int2      <span class="keyword">default</span> <span class="number">1</span>,</span><br><span class="line">    post_type   <span class="built_in">varchar</span>(<span class="number">64</span>),</span><br><span class="line">    post_status int2      <span class="keyword">default</span> <span class="number">1</span>,</span><br><span class="line">    remark      <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">200</span>),</span><br><span class="line">    read_only   int2      <span class="keyword">default</span> <span class="number">0</span>,</span><br><span class="line">    create_user  <span class="built_in">int8</span>,</span><br><span class="line">    create_dept  <span class="built_in">int8</span>,</span><br><span class="line">    create_time  <span class="built_in">timestamp</span>,</span><br><span class="line">    update_user  <span class="built_in">int8</span>,</span><br><span class="line">    update_dept  <span class="built_in">int8</span>,</span><br><span class="line">    update_time  <span class="built_in">timestamp</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">table</span> sys_post <span class="keyword">is</span> <span class="string">'岗位信息'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_post.post_id <span class="keyword">is</span> <span class="string">'岗位id'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_post.post_code <span class="keyword">is</span> <span class="string">'岗位编码'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_post.post_name <span class="keyword">is</span> <span class="string">'岗位名称'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_post.post_level <span class="keyword">is</span> <span class="string">'岗位级别'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_post.post_type <span class="keyword">is</span> <span class="string">'岗位类型'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_post.post_status <span class="keyword">is</span> <span class="string">'岗位状态'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_post.remark <span class="keyword">is</span> <span class="string">'备注'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_post.read_only <span class="keyword">is</span> <span class="string">'是否只读 1是 0否'</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><figcaption><span class="caption">4.岗位关系</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> sys_post_tree(</span><br><span class="line">    post_id   <span class="built_in">int8</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    parent_id <span class="built_in">int8</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    tree_type int2 <span class="keyword">default</span> <span class="number">1</span>,</span><br><span class="line">    <span class="keyword">constraint</span> sys_post_tree_pkey primary <span class="keyword">key</span> (post_id, parent_id, tree_type)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">table</span> sys_post_tree <span class="keyword">is</span> <span class="string">'岗位关系'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_post_tree.post_id <span class="keyword">is</span> <span class="string">'岗位id'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_post_tree.parent_id <span class="keyword">is</span> <span class="string">'上级岗位id'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_post_tree.tree_type <span class="keyword">is</span> <span class="string">'关系类型'</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><figcaption><span class="caption">5.部门岗位</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> sys_dept_post(</span><br><span class="line">    dept_id   <span class="built_in">int8</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    post_id   <span class="built_in">int8</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    is_default int2 <span class="keyword">default</span> <span class="number">0</span>,</span><br><span class="line">    <span class="keyword">constraint</span> sys_dept_post_pkey primary <span class="keyword">key</span> (dept_id, post_id)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">table</span> sys_dept_post <span class="keyword">is</span> <span class="string">'部门岗位'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_dept_post.dept_id <span class="keyword">is</span> <span class="string">'部门id'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_dept_post.post_id <span class="keyword">is</span> <span class="string">'岗位id'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_dept_post.is_default <span class="keyword">is</span> <span class="string">'是否部门默认岗位'</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>菜单</li>
</ul>
<figure class="highlight sql"><figcaption><span class="caption">6.菜单信息</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> sys_menu(</span><br><span class="line">    menu_id bigserial primary <span class="keyword">key</span>,</span><br><span class="line">    parent_id <span class="built_in">bigint</span> <span class="keyword">default</span> <span class="number">0</span>,</span><br><span class="line">    menu_name <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">64</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    menu_order <span class="built_in">integer</span> <span class="keyword">default</span> <span class="number">0</span>,</span><br><span class="line">    menu_permit <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">255</span>),</span><br><span class="line">    menu_path <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">255</span>) <span class="keyword">default</span> <span class="string">'#'</span>,</span><br><span class="line">    menu_param <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">255</span>),</span><br><span class="line">    menu_type <span class="built_in">char</span>(<span class="number">1</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    menu_icon <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">100</span>) <span class="keyword">default</span> <span class="string">'#'</span>,</span><br><span class="line">    component <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">255</span>),</span><br><span class="line">    menu_status   int2 <span class="keyword">default</span> <span class="number">1</span>,</span><br><span class="line">    is_frame      int2 <span class="keyword">DEFAULT</span> <span class="number">1</span>,</span><br><span class="line">    is_cache      int2 <span class="keyword">DEFAULT</span> <span class="number">1</span>,</span><br><span class="line">    is_visible    int2 <span class="keyword">DEFAULT</span> <span class="number">1</span>,</span><br><span class="line">    is_protected  int2 <span class="keyword">DEFAULT</span> <span class="number">1</span>,</span><br><span class="line">    remark        <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">200</span>),</span><br><span class="line">    read_only     int2 <span class="keyword">default</span> <span class="number">0</span>,</span><br><span class="line">    create_user   <span class="built_in">int8</span>,</span><br><span class="line">    create_dept   <span class="built_in">int8</span>,</span><br><span class="line">    create_time   <span class="built_in">timestamp</span>,</span><br><span class="line">    update_user   <span class="built_in">int8</span>,</span><br><span class="line">    update_dept   <span class="built_in">int8</span>,</span><br><span class="line">    update_time   <span class="built_in">timestamp</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">table</span> sys_menu <span class="keyword">is</span> <span class="string">'菜单信息'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_menu.menu_id <span class="keyword">is</span> <span class="string">'菜单id'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_menu.parent_id <span class="keyword">is</span> <span class="string">'父菜单id'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_menu.menu_name <span class="keyword">is</span> <span class="string">'菜单名称'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_menu.menu_order <span class="keyword">is</span> <span class="string">'菜单顺序'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_menu.menu_permit <span class="keyword">is</span> <span class="string">'权限标识'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_menu.menu_path <span class="keyword">is</span> <span class="string">'菜单路径'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_menu.menu_param <span class="keyword">is</span> <span class="string">'路径参数'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_menu.menu_type <span class="keyword">is</span> <span class="string">'菜单类型：M:目录 C:菜单 B:按钮'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_menu.menu_icon <span class="keyword">is</span> <span class="string">'菜单图标'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_menu.component <span class="keyword">is</span> <span class="string">'组件路径'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_menu.menu_status <span class="keyword">is</span> <span class="string">'菜单状态 1启用 2停用'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_menu.is_frame <span class="keyword">is</span> <span class="string">'是否内部链接 1是 0否'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_menu.is_cache <span class="keyword">is</span> <span class="string">'是否缓存 1是 0否'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_menu.is_visible <span class="keyword">is</span> <span class="string">'是否显示 1是 0否'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_menu.is_protected <span class="keyword">is</span> <span class="string">'是否受保护的菜单 1是 0否'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_menu.read_only <span class="keyword">is</span> <span class="string">'是否只读 1是 0否'</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>角色</li>
</ul>
<figure class="highlight sql"><figcaption><span class="caption">7.角色信息</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> sys_role(</span><br><span class="line">    role_id bigserial primary <span class="keyword">key</span>,</span><br><span class="line">    role_code   <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">100</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    role_name   <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">64</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    role_type   <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">64</span>),</span><br><span class="line">    remark      <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">200</span>),</span><br><span class="line">    read_only   int2      <span class="keyword">default</span> <span class="number">0</span>,</span><br><span class="line">    create_user  <span class="built_in">int8</span>,</span><br><span class="line">    create_dept  <span class="built_in">int8</span>,</span><br><span class="line">    create_time  <span class="built_in">timestamp</span>,</span><br><span class="line">    update_user  <span class="built_in">int8</span>,</span><br><span class="line">    update_dept  <span class="built_in">int8</span>,</span><br><span class="line">    update_time  <span class="built_in">timestamp</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">unique</span> <span class="keyword">index</span> sys_role_role_code <span class="keyword">on</span> sys_role(role_code);</span><br><span class="line"></span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">table</span> sys_role <span class="keyword">is</span> <span class="string">'角色信息'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_role.role_id <span class="keyword">is</span> <span class="string">'角色id'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_role.role_code <span class="keyword">is</span> <span class="string">'角色编码'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_role.role_name <span class="keyword">is</span> <span class="string">'角色名称'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_role.role_type <span class="keyword">is</span> <span class="string">'角色类型'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_role.remark <span class="keyword">is</span> <span class="string">'备注'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_role.read_only <span class="keyword">is</span> <span class="string">'是否只读 1是 0否'</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><figcaption><span class="caption">8.角色菜单</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> sys_role_menu(</span><br><span class="line">    role_id <span class="built_in">bigint</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    menu_id <span class="built_in">bigint</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    <span class="keyword">constraint</span> sys_role_menu_pkey primary <span class="keyword">key</span> (role_id, menu_id)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">table</span> sys_role_menu <span class="keyword">is</span> <span class="string">'角色菜单'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_role_menu.role_id <span class="keyword">is</span> <span class="string">'角色id'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_role_menu.menu_id <span class="keyword">is</span> <span class="string">'菜单id'</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>用户</li>
</ul>
<figure class="highlight sql"><figcaption><span class="caption">9.用户信息</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> sys_user(</span><br><span class="line">    user_id      bigserial primary <span class="keyword">key</span>,</span><br><span class="line">    user_code    <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">64</span>),</span><br><span class="line">    user_name    <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">64</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    user_account <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">64</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    user_passwd  <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">256</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    user_sex     int2      <span class="keyword">default</span> <span class="number">0</span>,</span><br><span class="line">    user_phone   <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">11</span>),</span><br><span class="line">    user_email   <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">128</span>),</span><br><span class="line">    user_status  int2      <span class="keyword">default</span> <span class="number">1</span>,</span><br><span class="line">    <span class="keyword">rank</span>         <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">64</span>),</span><br><span class="line">    remark       <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">200</span>),</span><br><span class="line">    read_only    int2      <span class="keyword">default</span> <span class="number">0</span>,</span><br><span class="line">    create_user  <span class="built_in">int8</span>,</span><br><span class="line">    create_dept  <span class="built_in">int8</span>,</span><br><span class="line">    create_time  <span class="built_in">timestamp</span>,</span><br><span class="line">    update_user  <span class="built_in">int8</span>,</span><br><span class="line">    update_dept  <span class="built_in">int8</span>,</span><br><span class="line">    update_time  <span class="built_in">timestamp</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">unique</span> <span class="keyword">index</span> sys_user_user_account <span class="keyword">on</span> sys_user(user_account);</span><br><span class="line"></span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">table</span> sys_user <span class="keyword">is</span> <span class="string">'用户信息'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_user.user_id <span class="keyword">is</span> <span class="string">'用户id'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_user.user_code <span class="keyword">is</span> <span class="string">'用户编码'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_user.user_name <span class="keyword">is</span> <span class="string">'用户名称'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_user.user_account <span class="keyword">is</span> <span class="string">'用户账号'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_user.user_passwd <span class="keyword">is</span> <span class="string">'用户密码'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_user.user_sex <span class="keyword">is</span> <span class="string">'用户性别'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_user.user_phone <span class="keyword">is</span> <span class="string">'用户电话'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_user.user_email <span class="keyword">is</span> <span class="string">'用户邮箱'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_user.user_status <span class="keyword">is</span> <span class="string">'用户状态'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_user.rank <span class="keyword">is</span> <span class="string">'职级'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_user.remark <span class="keyword">is</span> <span class="string">'备注'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_user.read_only <span class="keyword">is</span> <span class="string">'是否只读 1是 0否'</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><figcaption><span class="caption">10.用户关系</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> sys_user_tree(</span><br><span class="line">    user_id   <span class="built_in">int8</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    parent_id <span class="built_in">int8</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    tree_type int2 <span class="keyword">default</span> <span class="number">1</span>,</span><br><span class="line">    <span class="keyword">constraint</span> sys_user_tree_pkey primary <span class="keyword">key</span> (user_id, parent_id, tree_type)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">table</span> sys_user_tree <span class="keyword">is</span> <span class="string">'用户关系'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_user_tree.user_id <span class="keyword">is</span> <span class="string">'用户id'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_user_tree.parent_id <span class="keyword">is</span> <span class="string">'上级用户id'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_user_tree.tree_type <span class="keyword">is</span> <span class="string">'关系类型'</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><figcaption><span class="caption">11.用户部门岗位</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> sys_user_dept(</span><br><span class="line">    <span class="keyword">id</span>         bigserial primary <span class="keyword">key</span>,</span><br><span class="line">    user_id    <span class="built_in">int8</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    dept_id    <span class="built_in">int8</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    post_id    <span class="built_in">int8</span> <span class="keyword">default</span> <span class="number">-1</span>,</span><br><span class="line">    is_default int2 <span class="keyword">default</span> <span class="number">0</span>,</span><br><span class="line">    is_leader  int2 <span class="keyword">default</span> <span class="number">0</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">unique</span> <span class="keyword">index</span> sys_user_dept_uk <span class="keyword">on</span> sys_user_dept(user_id, dept_id, post_id);</span><br><span class="line"></span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">table</span> sys_user_dept <span class="keyword">is</span> <span class="string">'用户部门'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_user_dept.id <span class="keyword">is</span> <span class="string">'主键'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_user_dept.user_id <span class="keyword">is</span> <span class="string">'用户id'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_user_dept.dept_id <span class="keyword">is</span> <span class="string">'部门id'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_user_dept.post_id <span class="keyword">is</span> <span class="string">'岗位id'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_user_dept.is_default <span class="keyword">is</span> <span class="string">'是否用户默认部门'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_user_dept.is_leader <span class="keyword">is</span> <span class="string">'是否部门负责人'</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><figcaption><span class="caption">12.用户角色</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> sys_user_role(</span><br><span class="line">    user_id <span class="built_in">bigint</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    role_id <span class="built_in">bigint</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    <span class="keyword">constraint</span> sys_user_role_pkey primary <span class="keyword">key</span> (user_id, role_id)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">table</span> sys_user_role <span class="keyword">is</span> <span class="string">'用户角色'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_user_role.user_id <span class="keyword">is</span> <span class="string">'用户id'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_user_role.role_id <span class="keyword">is</span> <span class="string">'角色id'</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>字典</li>
</ul>
<figure class="highlight sql"><figcaption><span class="caption">13.字典信息</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> sys_dict(</span><br><span class="line">    <span class="keyword">id</span> bigserial primary <span class="keyword">key</span>,</span><br><span class="line">    parent_code <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">100</span>),</span><br><span class="line">    dict_code <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">100</span>),</span><br><span class="line">    dict_label <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">100</span>),</span><br><span class="line">    dict_en <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">100</span>),</span><br><span class="line">    dict_value <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">100</span>),</span><br><span class="line">    value_parser <span class="built_in">varchar</span>(<span class="number">100</span>),</span><br><span class="line">    value_param <span class="built_in">varchar</span>(<span class="number">100</span>),</span><br><span class="line">    dict_order int2 <span class="keyword">default</span> <span class="number">0</span>,</span><br><span class="line">    is_default int2 <span class="keyword">default</span> <span class="number">0</span>,</span><br><span class="line">    css <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">100</span>),</span><br><span class="line">    <span class="keyword">status</span> int2 <span class="keyword">default</span> <span class="number">1</span>,</span><br><span class="line">    remark      <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">200</span>),</span><br><span class="line">    read_only int2 <span class="keyword">default</span> <span class="number">0</span>,</span><br><span class="line">    create_user  <span class="built_in">int8</span>,</span><br><span class="line">    create_dept  <span class="built_in">int8</span>,</span><br><span class="line">    create_time  <span class="built_in">timestamp</span>,</span><br><span class="line">    update_user  <span class="built_in">int8</span>,</span><br><span class="line">    update_dept  <span class="built_in">int8</span>,</span><br><span class="line">    update_time  <span class="built_in">timestamp</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">unique</span> <span class="keyword">index</span> sys_dict_uk <span class="keyword">on</span> sys_dict(dict_code);</span><br><span class="line"></span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">table</span> sys_dict <span class="keyword">is</span> <span class="string">'字典数据'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_dict.id <span class="keyword">is</span> <span class="string">'主键'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_dict.parent_code <span class="keyword">is</span> <span class="string">'父字典编码'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_dict.dict_code <span class="keyword">is</span> <span class="string">'字典编码'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_dict.dict_label <span class="keyword">is</span> <span class="string">'字典标签'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_dict.dict_en <span class="keyword">is</span> <span class="string">'英文标签'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_dict.dict_value <span class="keyword">is</span> <span class="string">'字典值'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_dict.value_parser <span class="keyword">is</span> <span class="string">'值转换器'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_dict.value_param <span class="keyword">is</span> <span class="string">'转换参数'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_dict.dict_order <span class="keyword">is</span> <span class="string">'字典排序'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_dict.status <span class="keyword">is</span> <span class="string">'字典状态'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_dict.is_default <span class="keyword">is</span> <span class="string">'是否默认'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_dict.read_only <span class="keyword">is</span> <span class="string">'是否只读 1是 0否'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_dict.css <span class="keyword">is</span> <span class="string">'字典展示样式'</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>公告</li>
</ul>
<figure class="highlight sql"><figcaption><span class="caption">14.公告信息</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> sys_notice(</span><br><span class="line">    notice_id bigserial primary <span class="keyword">key</span>,</span><br><span class="line">    notice_title   <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">255</span>),</span><br><span class="line">    notice_status  int2 <span class="keyword">default</span> <span class="number">0</span>,</span><br><span class="line">    notice_type    int2 <span class="keyword">default</span> <span class="number">0</span>,</span><br><span class="line">    notice_level   int2 <span class="keyword">default</span> <span class="number">0</span>,</span><br><span class="line">    <span class="keyword">content</span>        <span class="built_in">text</span>,</span><br><span class="line">    is_system      int2 <span class="keyword">default</span> <span class="number">0</span>,</span><br><span class="line">    stat_total     int4 <span class="keyword">default</span> <span class="number">0</span>,</span><br><span class="line">    stat_read      int4 <span class="keyword">default</span> <span class="number">0</span>,</span><br><span class="line">    goals_all      int2 <span class="keyword">default</span> <span class="number">0</span>,</span><br><span class="line">    goals_dept     <span class="built_in">int8</span>[],</span><br><span class="line">    goals_role     <span class="built_in">int8</span>[],</span><br><span class="line">    goals_user     <span class="built_in">int8</span>[],</span><br><span class="line">    publish_time   <span class="built_in">timestamp</span>,</span><br><span class="line">    create_user  <span class="built_in">int8</span>,</span><br><span class="line">    create_dept  <span class="built_in">int8</span>,</span><br><span class="line">    create_time  <span class="built_in">timestamp</span>,</span><br><span class="line">    update_user  <span class="built_in">int8</span>,</span><br><span class="line">    update_dept  <span class="built_in">int8</span>,</span><br><span class="line">    update_time  <span class="built_in">timestamp</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">table</span> sys_notice <span class="keyword">is</span> <span class="string">'系统公告'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_notice.notice_id <span class="keyword">is</span> <span class="string">'公告id'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_notice.notice_title <span class="keyword">is</span> <span class="string">'标题'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_notice.notice_status <span class="keyword">is</span> <span class="string">'公告状态 0草稿 1已发布 2已撤回 3已删除'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_notice.notice_type <span class="keyword">is</span> <span class="string">'公告类型 0公告 1通知'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_notice.notice_level <span class="keyword">is</span> <span class="string">'公告等级 0普通 1紧急'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_notice.content <span class="keyword">is</span> <span class="string">'公告内容'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_notice.is_system <span class="keyword">is</span> <span class="string">'是否系统公告 0否 1是'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_notice.stat_total <span class="keyword">is</span> <span class="string">'目标数'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_notice.stat_read <span class="keyword">is</span> <span class="string">'已读数'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_notice.goals_all <span class="keyword">is</span> <span class="string">'是否全员 0否 1是'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_notice.goals_dept <span class="keyword">is</span> <span class="string">'目标单位'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_notice.goals_role <span class="keyword">is</span> <span class="string">'目标角色'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_notice.goals_user <span class="keyword">is</span> <span class="string">'目标用户'</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><figcaption><span class="caption">15.已读信息</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> sys_notice_read(</span><br><span class="line">    <span class="keyword">id</span>  bigserial primary <span class="keyword">key</span>,</span><br><span class="line">    notice_id     <span class="built_in">int8</span>,</span><br><span class="line">    user_id       <span class="built_in">int8</span>,</span><br><span class="line">    read_status   int2 <span class="keyword">default</span> <span class="number">0</span>,</span><br><span class="line">    read_back   <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">512</span>),</span><br><span class="line">    read_time   <span class="built_in">timestamp</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">unique</span> <span class="keyword">index</span> sys_notice_read_uk <span class="keyword">on</span> sys_notice_read(user_id, notice_id);</span><br><span class="line"></span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">table</span> sys_notice_read <span class="keyword">is</span> <span class="string">'公告已读'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_notice_read.id <span class="keyword">is</span> <span class="string">'主键'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_notice_read.notice_id <span class="keyword">is</span> <span class="string">'公告id'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_notice_read.user_id <span class="keyword">is</span> <span class="string">'用户id'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_notice_read.read_status <span class="keyword">is</span> <span class="string">'已读状态'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_notice_read.read_back <span class="keyword">is</span> <span class="string">'读反馈'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_notice_read.read_time <span class="keyword">is</span> <span class="string">'读时间'</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>系统配置</li>
</ul>
<figure class="highlight sql"><figcaption><span class="caption">16.系统配置</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> sys_config(</span><br><span class="line">    config_id    <span class="built_in">serial</span> primary <span class="keyword">key</span>,</span><br><span class="line">    config_name  <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">    config_key   <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">    config_value <span class="built_in">varchar</span>(<span class="number">500</span>) <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">    value_parser <span class="built_in">varchar</span>(<span class="number">100</span>),</span><br><span class="line">    value_param  <span class="built_in">varchar</span>(<span class="number">100</span>),</span><br><span class="line">    is_default   int2         <span class="keyword">DEFAULT</span> <span class="number">0</span>,</span><br><span class="line">    remark       <span class="built_in">varchar</span>(<span class="number">500</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">    create_user  <span class="built_in">int8</span>,</span><br><span class="line">    create_dept  <span class="built_in">int8</span>,</span><br><span class="line">    create_time  <span class="built_in">timestamp</span>,</span><br><span class="line">    update_user  <span class="built_in">int8</span>,</span><br><span class="line">    update_dept  <span class="built_in">int8</span>,</span><br><span class="line">    update_time  <span class="built_in">timestamp</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">unique</span> <span class="keyword">index</span> sys_config_config_key <span class="keyword">on</span> sys_config(config_key);</span><br><span class="line"></span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">table</span> sys_config <span class="keyword">is</span> <span class="string">'系统配置'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_config.config_id <span class="keyword">is</span> <span class="string">'参数id'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_config.config_name <span class="keyword">is</span> <span class="string">'参数名称'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_config.config_key <span class="keyword">is</span> <span class="string">'参数键'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_config.config_value <span class="keyword">is</span> <span class="string">'参数值'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_config.value_parser <span class="keyword">is</span> <span class="string">'值转换器'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_config.value_param <span class="keyword">is</span> <span class="string">'转换参数'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_config.is_default <span class="keyword">is</span> <span class="string">'是否默认 1是 0否'</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>附件信息</li>
</ul>
<figure class="highlight sql"><figcaption><span class="caption">17.附件信息</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> sys_attach(</span><br><span class="line">    attach_id     bigserial primary <span class="keyword">key</span>,</span><br><span class="line">    master_id     <span class="built_in">int8</span>,</span><br><span class="line">    attach_group  <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">64</span>),</span><br><span class="line">    attach_type   <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">64</span>),</span><br><span class="line">    attach_name   <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">1024</span>),</span><br><span class="line">    attach_size   <span class="built_in">int8</span>,</span><br><span class="line">    attach_path   <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">1024</span>),</span><br><span class="line">    attach_status int2 <span class="keyword">default</span> <span class="number">0</span>,</span><br><span class="line">    is_protected  int2 <span class="keyword">default</span> <span class="number">0</span>,</span><br><span class="line">    create_time   <span class="built_in">timestamp</span>,</span><br><span class="line">    expire_set    int2 <span class="keyword">default</span> <span class="number">0</span>,</span><br><span class="line">    expire_time   <span class="built_in">timestamp</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">index</span> sys_attach_master <span class="keyword">on</span> sys_attach(attach_group, master_id);</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">index</span> sys_attach_attach_path <span class="keyword">on</span> sys_attach(attach_path);</span><br><span class="line"></span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">table</span> sys_attach <span class="keyword">is</span> <span class="string">'附件信息'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_attach.attach_id <span class="keyword">is</span> <span class="string">'附件id'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_attach.master_id <span class="keyword">is</span> <span class="string">'宿主id'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_attach.attach_group <span class="keyword">is</span> <span class="string">'附件分组'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_attach.attach_type <span class="keyword">is</span> <span class="string">'附件类型'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_attach.attach_name <span class="keyword">is</span> <span class="string">'附件名称'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_attach.attach_size <span class="keyword">is</span> <span class="string">'附件大小'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_attach.attach_path <span class="keyword">is</span> <span class="string">'附件路径'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_attach.attach_status <span class="keyword">is</span> <span class="string">'附件状态 0未生效 1已生效'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_attach.is_protected <span class="keyword">is</span> <span class="string">'是否受保护的 0否 1是'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_attach.create_time <span class="keyword">is</span> <span class="string">'创建时间'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_attach.expire_set <span class="keyword">is</span> <span class="string">'是否设置过期时间 0未设置 1设置'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_attach.expire_time <span class="keyword">is</span> <span class="string">'过期时间'</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>操作日志</li>
</ul>
<figure class="highlight sql"><figcaption><span class="caption">18.操作日志</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> sys_log(</span><br><span class="line">    <span class="keyword">id</span> bigserial primary <span class="keyword">key</span>,</span><br><span class="line">    user_id <span class="built_in">int8</span>,</span><br><span class="line">    dept_id <span class="built_in">int8</span>,</span><br><span class="line">    log_group <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">64</span>),</span><br><span class="line">    log_type <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">64</span>),</span><br><span class="line">    log_action <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">64</span>),</span><br><span class="line">    ip  <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">128</span>),</span><br><span class="line">    <span class="keyword">url</span> <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">255</span>),</span><br><span class="line">    log_desc <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">255</span>) <span class="keyword">default</span> <span class="string">''</span> ,</span><br><span class="line">    log_content <span class="keyword">json</span>,</span><br><span class="line">    log_status int2 <span class="keyword">default</span> <span class="number">1</span>,</span><br><span class="line">    log_time <span class="built_in">timestamp</span></span><br><span class="line"></span><br><span class="line">);</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">table</span> sys_log <span class="keyword">is</span> <span class="string">'操作日志'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_log.id <span class="keyword">is</span> <span class="string">'日志id'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_log.user_id <span class="keyword">is</span> <span class="string">'用户id'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_log.dept_id <span class="keyword">is</span> <span class="string">'部门id'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_log.log_group <span class="keyword">is</span> <span class="string">'日志模块'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_log.log_type <span class="keyword">is</span> <span class="string">'日志类型'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_log.log_action <span class="keyword">is</span> <span class="string">'日志动作'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_log.ip <span class="keyword">is</span> <span class="string">'访问ip'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_log.url <span class="keyword">is</span> <span class="string">'访问url'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_log.log_desc <span class="keyword">is</span> <span class="string">'日志描述'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_log.log_content <span class="keyword">is</span> <span class="string">'日志详情'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_log.log_status <span class="keyword">is</span> <span class="string">'日志状态'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_log.log_time <span class="keyword">is</span> <span class="string">'日志时间'</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>系统告警</li>
</ul>
<figure class="highlight sql"><figcaption><span class="caption">19.系统告警</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> sys_alarm(</span><br><span class="line">    <span class="keyword">id</span>            bigserial primary <span class="keyword">key</span>,</span><br><span class="line">    alarm_code    <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">128</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    alarm_type    <span class="built_in">int8</span>,</span><br><span class="line">    alarm_level   int2      <span class="keyword">default</span> <span class="number">1</span>,</span><br><span class="line">    source_id     <span class="built_in">int8</span>,</span><br><span class="line">    source_name   <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">64</span>),</span><br><span class="line">    source_type   <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">64</span>),</span><br><span class="line">    alarm_status  int2      <span class="keyword">default</span> <span class="number">0</span>,</span><br><span class="line">    alarm_times   int4      <span class="keyword">default</span> <span class="number">1</span>,</span><br><span class="line">    first_time    <span class="built_in">timestamp</span>,</span><br><span class="line">    last_time     <span class="built_in">timestamp</span>,</span><br><span class="line">    alarm_desc    <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">255</span>),</span><br><span class="line">    alarm_content <span class="keyword">json</span>      <span class="keyword">default</span> <span class="string">'&#123;&#125;'</span>,</span><br><span class="line">    resolve_user  <span class="built_in">int8</span>,</span><br><span class="line">    resolve_msg   <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">255</span>),</span><br><span class="line">    resolve_time  <span class="built_in">timestamp</span>,</span><br><span class="line">    resolve_type  int2      <span class="keyword">default</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line">);</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">index</span> sys_alarm_alarm_code <span class="keyword">on</span> sys_alarm(alarm_code);</span><br><span class="line"></span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">table</span> sys_alarm <span class="keyword">is</span> <span class="string">'系统告警'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_alarm.id <span class="keyword">is</span> <span class="string">'告警id'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_alarm.alarm_code <span class="keyword">is</span> <span class="string">'唯一编码'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_alarm.alarm_type <span class="keyword">is</span> <span class="string">'告警类型'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_alarm.source_id <span class="keyword">is</span> <span class="string">'告警来源id'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_alarm.source_name <span class="keyword">is</span> <span class="string">'告警来源名称'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_alarm.source_type <span class="keyword">is</span> <span class="string">'告警来源类型'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_alarm.alarm_level <span class="keyword">is</span> <span class="string">'告警级别：1提示 2普通 3重要 4严重 5灾难'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_alarm.alarm_status <span class="keyword">is</span> <span class="string">'告警状态 0未处理 1已确认 2已解决'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_alarm.alarm_times <span class="keyword">is</span> <span class="string">'告警次数'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_alarm.first_time <span class="keyword">is</span> <span class="string">'首次告警时间'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_alarm.last_time <span class="keyword">is</span> <span class="string">'最后告警时间'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_alarm.alarm_desc <span class="keyword">is</span> <span class="string">'告警描述'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_alarm.alarm_content <span class="keyword">is</span> <span class="string">'告警内容'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_alarm.resolve_user <span class="keyword">is</span> <span class="string">'处理人'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_alarm.resolve_time <span class="keyword">is</span> <span class="string">'处理时间'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_alarm.resolve_msg <span class="keyword">is</span> <span class="string">'处理意见'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_alarm.resolve_type <span class="keyword">is</span> <span class="string">'处理方式：1:手动 2:自动'</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><figcaption><span class="caption">20.告警类型</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> sys_alarm_type(</span><br><span class="line">    <span class="keyword">id</span>           bigserial primary <span class="keyword">key</span>,</span><br><span class="line">    type_name    <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">128</span>),</span><br><span class="line">    type_view    <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">128</span>),</span><br><span class="line">    type_content <span class="keyword">json</span>      <span class="keyword">default</span> <span class="string">'&#123;&#125;'</span>,</span><br><span class="line">    description  <span class="built_in">text</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">table</span> sys_alarm_type <span class="keyword">is</span> <span class="string">'告警类型'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_alarm_type.id <span class="keyword">is</span> <span class="string">'主键'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_alarm_type.type_name <span class="keyword">is</span> <span class="string">'类型名称'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_alarm_type.type_view <span class="keyword">is</span> <span class="string">'类型表单'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_alarm_type.type_content <span class="keyword">is</span> <span class="string">'字段内容'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_alarm_type.description <span class="keyword">is</span> <span class="string">'类型描述'</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><figcaption><span class="caption">21.告警级别</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> sys_alarm_level(</span><br><span class="line">    <span class="keyword">id</span>           bigserial primary <span class="keyword">key</span>,</span><br><span class="line">    alarm_type   <span class="built_in">int8</span>,</span><br><span class="line">    alarm_level  int2,</span><br><span class="line">    level_rule   <span class="keyword">json</span> <span class="keyword">default</span> <span class="string">'&#123;&#125;'</span>,</span><br><span class="line">    description  <span class="built_in">text</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">table</span> sys_alarm_level <span class="keyword">is</span> <span class="string">'告警类型'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_alarm_level.id <span class="keyword">is</span> <span class="string">'主键'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_alarm_level.alarm_type <span class="keyword">is</span> <span class="string">'告警类型'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_alarm_level.alarm_level <span class="keyword">is</span> <span class="string">'告警级别'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_alarm_level.level_rule <span class="keyword">is</span> <span class="string">'级别判断规则'</span>;</span><br><span class="line"><span class="keyword">comment</span> <span class="keyword">on</span> <span class="keyword">column</span> sys_alarm_level.description <span class="keyword">is</span> <span class="string">'级别描述'</span>;</span><br></pre></td></tr></table></figure>
<p><br><strong>参考：</strong></p>

      
    </div>
	
    <footer>
      
	  
	    
	<nav id="pagination">
	  
		  <a class="alignleft prev" href="/2022/04/05/20220405/">
		    Bean Validation对象验证标准
		  </a>
	  
	  
	  
		  <a class="alignright next" href="/2022/04/01/20220401/">
		    关于代码评审的一些思考
		  </a>
	  
	  <div class="clearfix"></div>
	</nav>
	
	    
        
  
  <div class="categories">
    <a href="/categories/开发笔记/">开发笔记</a>
  </div>


        

         		        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk@latest/dist/gitalk.min.js"></script>
<script src="/js/md5.min.js"></script>
<div id="gitalk-container"></div>
<script type="text/javascript">
    var gitalk = new Gitalk({
        clientID: 'd7beb7890a79c73a3e3d',
        clientSecret: '80ea1fc195ae4b80cbd65ec9f1ce68d59595af4b',
        id: md5(window.location.pathname),
        repo: 'shanhm1991.github.io',
        owner: 'shanhm1991',
        admin: 'shanhm1991'
    })
    gitalk.render('gitalk-container')
</script>                              



</div></div>
    <aside id="sidebar" class="alignright">
  


  

<script src="/js/jquery-3.4.1.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){
    $("#os_ul").click(function(){ $("#os_li").toggle(); });
    $("#xx_ul").click(function(){ $("#xx_li").toggle(); });
});
</script>


  

  
<div class="widget catlog">
<h3 class="title">Catlog</h3>
<ul class="entry_catlog">
<ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#用户部门岗位"><span class="toc-text">用户部门岗位</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#角色菜单权限"><span class="toc-text">角色菜单权限</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#字典信息"><span class="toc-text">字典信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#附件信息"><span class="toc-text">附件信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#操作日志"><span class="toc-text">操作日志</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#系统公告"><span class="toc-text">系统公告</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#系统告警"><span class="toc-text">系统告警</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#数据权限"><span class="toc-text">数据权限</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#国际化处理"><span class="toc-text">国际化处理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#附录：表结构"><span class="toc-text">附录：表结构</span></a>
</div>





  
</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">

  
  
      &copy; 2017-2024 &nbsp;&nbsp; shanhm1991 &nbsp;&nbsp; version@1.0.0 
  
  
  
  <font style="float: right">
</div>
<div class="clearfix"></div>
</footer>
  
<script src="/js/jquery-3.4.1.min.js"></script>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>
